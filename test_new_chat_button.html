<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test New Chat Button</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid px-1 mt-3">
        <div class="row g-1">
            <div class="col-12">
                <div class="card shadow border-0">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center py-2">
                        <div class="d-flex align-items-center gap-3">
                            <h4 class="mb-0"><i class="fas fa-comment-medical me-2"></i>Health Assistant</h4>
                        </div>

                        <div class="d-flex gap-1">
                            <button id="new-chat" class="btn btn-sm btn-outline-light" title="Start new conversation">
                                <i class="fas fa-plus"></i>
                            </button>
                            <button id="copy-chat" class="btn btn-sm btn-outline-light" title="Copy conversation">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button id="export-md" class="btn btn-sm btn-outline-light" title="Export to Markdown">
                                <i class="fas fa-download"></i>
                            </button>
                            <button id="clear-chat" class="btn btn-sm btn-outline-light" title="Clear conversation">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body p-3">
                        <div id="chat-messages" style="height: 400px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 0.5rem; padding: 1rem; background-color: #f8f9fa;">
                            <div class="welcome-message text-center text-muted py-4">
                                <i class="fas fa-comment-medical fa-3x mb-3"></i>
                                <h5>Welcome to your Health Assistant</h5>
                                <p>Ask me anything about your health, medications, or use the quick questions.</p>
                            </div>
                        </div>

                        <div class="mt-3">
                            <form id="chat-form" class="mb-0">
                                <div class="input-group">
                                    <input type="text" id="chat-input" class="form-control" placeholder="Type your health question here..." required>
                                    <button class="btn btn-primary" type="submit">
                                        <i class="fas fa-paper-plane"></i>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Simplified test of the new chat button functionality
        class TestChatManager {
            constructor() {
                this.chatMessages = document.getElementById('chat-messages');
                this.chatInput = document.getElementById('chat-input');
                this.conversationHistory = [];
                this.init();
            }

            init() {
                this.setupActionButtons();
                this.setupEventListeners();
            }

            setupActionButtons() {
                const newBtn = document.getElementById('new-chat');
                const clearBtn = document.getElementById('clear-chat');
                const copyBtn = document.getElementById('copy-chat');
                const exportBtn = document.getElementById('export-md');

                if (newBtn) {
                    newBtn.addEventListener('click', () => this.startNewConversation());
                }

                if (clearBtn) {
                    clearBtn.addEventListener('click', () => {
                        if (confirm('Are you sure you want to clear the conversation history?')) {
                            this.clearConversation();
                        }
                    });
                }

                if (copyBtn) {
                    copyBtn.addEventListener('click', () => {
                        alert('Copy functionality would work here');
                    });
                }

                if (exportBtn) {
                    exportBtn.addEventListener('click', () => {
                        alert('Export functionality would work here');
                    });
                }
            }

            setupEventListeners() {
                document.getElementById('chat-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addTestMessage();
                });
            }

            addTestMessage() {
                const message = this.chatInput.value.trim();
                if (!message) return;

                // Add user message
                this.appendMessage('user', message);
                this.conversationHistory.push({ role: 'user', content: message, timestamp: new Date().toISOString() });
                this.chatInput.value = '';

                // Add bot response after a delay
                setTimeout(() => {
                    this.appendMessage('assistant', 'This is a test response from the Health Assistant.');
                    this.conversationHistory.push({ role: 'assistant', content: 'This is a test response from the Health Assistant.', timestamp: new Date().toISOString() });
                }, 1000);
            }

            appendMessage(sender, text) {
                const messageEl = document.createElement('div');
                messageEl.className = `d-flex mb-3 ${sender === 'user' ? 'justify-content-end' : ''}`;

                const bubbleClass = sender === 'user' ? 'bg-primary text-white' : 'bg-light';
                messageEl.innerHTML = `
                    <div class="p-2 rounded ${bubbleClass}" style="max-width: 70%;">
                        <div class="small ${sender === 'user' ? 'text-white-50' : 'text-muted'}">${sender === 'user' ? 'You' : 'Assistant'}</div>
                        <div>${text}</div>
                    </div>
                `;

                this.chatMessages.appendChild(messageEl);
                this.chatMessages.scrollTop = this.chatMessages.scrollHeight;

                // Hide welcome message if this is the first message
                const welcomeMsg = this.chatMessages.querySelector('.welcome-message');
                if (welcomeMsg && this.conversationHistory.length > 0) {
                    welcomeMsg.style.display = 'none';
                }
            }

            clearConversation() {
                // Remove all message elements except welcome message
                const messages = this.chatMessages.querySelectorAll('.d-flex.mb-3');
                messages.forEach(msg => msg.remove());

                this.conversationHistory = [];
                this.updateWelcomeMessage();
            }

            startNewConversation() {
                if (this.conversationHistory.length > 0) {
                    if (confirm('Start a new conversation? Current conversation will be lost unless you export it first.')) {
                        this.clearConversation();
                        this.chatInput.focus();
                    }
                } else {
                    this.updateWelcomeMessage();
                    this.chatInput.focus();
                }
            }

            updateWelcomeMessage() {
                const welcomeMsg = this.chatMessages.querySelector('.welcome-message');
                if (welcomeMsg) {
                    welcomeMsg.style.display = 'block';
                }
            }
        }

        // Initialize the test chat manager
        document.addEventListener('DOMContentLoaded', () => {
            new TestChatManager();
        });
    </script>
</body>
</html>
